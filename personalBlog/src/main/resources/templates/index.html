<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>My Coding Life</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>

<header class="blog-header" onclick="location.href='/'" style="height: 200px; cursor: pointer;">
    <h1 class="blog-title" style="font-size: 2.5rem;">My Coding Life</h1>
    <p class="blog-subtitle">소소한 일상과 개발 기록을 남기는 공간</p>
</header>

<nav class="navbar navbar-expand-lg blog-nav sticky-top">
    <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
            </ul>
            
            <ul class="navbar-nav ms-auto align-items-center">
                
                <li class="nav-item" sec:authorize="isAnonymous()"><a class="nav-link" href="/auth/loginForm">로그인</a></li>
                <li class="nav-item" sec:authorize="isAnonymous()"><a class="nav-link" href="/auth/joinForm">회원가입</a></li>
                
                <li class="nav-item d-flex align-items-center" sec:authorize="isAuthenticated()">
                    
                    <a th:if="${#authentication.principal.user.role.name() == 'ADMIN'}" 
                       href="/admin" class="btn btn-danger btn-sm rounded-pill me-3">관리자</a>

                    <img th:src="${#authentication.principal.user.profileUrl != null ? #authentication.principal.user.profileUrl : 'https://dummyimage.com/40x40/dee2e6/6c757d.jpg'}"
                         class="rounded-circle me-2 border" 
                         style="width: 40px; height: 40px; object-fit: cover;">

                    <a href="/user/updateForm" class="text-decoration-none fw-bold text-dark me-3" 
                       data-bs-toggle="tooltip" title="회원정보 수정">
                       <span sec:authentication="principal.user.nickname">User</span>님
                    </a>
                    
                    <a class="btn btn-outline-secondary btn-sm rounded-pill" href="/logout">로그아웃</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container main-box">

    <div class="board-toolbar">
        <div class="category-filter">
            <a th:href="@{/(category='ALL')}" 
               th:classappend="${category == null || category == 'ALL'} ? 'active'">전체글</a>
               
            <a th:href="@{/(category='DAILY')}" 
               th:classappend="${category == 'DAILY'} ? 'active'">일상</a>
               
            <a th:href="@{/(category='DEV')}" 
               th:classappend="${category == 'DEV'} ? 'active'">개발기록</a>
               
            <a th:href="@{/(category='NOTICE')}" 
               th:classappend="${category == 'NOTICE'} ? 'active'">공지사항</a>
               
            <a th:href="@{/(category='QNA')}" 
               th:classappend="${category == 'QNA'} ? 'active'">QnA</a>
               
            <a th:href="@{/(category='GALLERY')}" 
               th:classappend="${category == 'GALLERY'} ? 'active'">자료실</a>
        </div>

        <a sec:authorize="isAuthenticated()" href="/board/saveForm" class="btn btn-write-custom">
            <i class="bi bi-pencil-fill"></i> 글쓰기
        </a>
    </div>

    <table class="board-table">
        <colgroup>
            <col style="width: 8%;">  <col style="width: 10%;"> <col style="width: auto;"> <col style="width: 12%;"> <col style="width: 12%;"> <col style="width: 8%;">  <col style="width: 8%;">  </colgroup>
        <thead>
            <tr>
                <th>번호</th>
                <th>말머리</th>
                <th>제목</th>
                <th>글쓴이</th>
                <th>작성일</th>
                <th>조회</th>
                <th>추천</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="post : ${posts.content}">
                <td th:text="${post.id}">1</td>
                
                <td>
                    <span class="badge bg-light" th:text="${post.boardType}">일상</span>
                </td>
                
                <td class="title-col">
                    <a th:href="@{/board/{id}(id=${post.id})}">
                        <span th:text="${post.title}">게시글 제목입니다.</span>
                        <span class="comment-cnt" th:if="${post.replys.size() > 0}" 
                              th:text="'[' + ${post.replys.size()} + ']'">[0]</span>
                    </a>
                </td>
                
                <td th:text="${post.user.nickname}">홍길동</td>
                
                <td th:text="${#dates.format(post.createDate, 'yyyy-MM-dd')}">2026-01-07</td>
                
                <td th:text="${post.count}">0</td>
                
                <td th:text="${post.loves.size()}">0</td>
            </tr>
            
            <tr th:if="${posts.empty}">
                <td colspan="7" class="py-5 text-center text-muted">
                    등록된 게시글이 없습니다. 첫 글을 작성해보세요!
                </td>
            </tr>
        </tbody>
    </table>

    <div class="search-box">
        <form class="d-flex" method="GET" action="/">
            <input type="hidden" name="category" th:value="${category}">
            
            <input class="form-control" type="search" name="search" 
                   placeholder="검색어 입력" th:value="${search}" style="width: 250px;">
            <button class="btn btn-secondary ms-2" type="submit">검색</button>
        </form>
    </div>

    <div class="mt-4" th:if="${!posts.empty}">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${posts.first} ? 'disabled'">
                <a class="page-link" 
                   th:href="@{/(page=${posts.number - 1}, search=${search}, category=${category})}">이전</a>
            </li>
            
            <li class="page-item" th:classappend="${posts.last} ? 'disabled'">
                <a class="page-link" 
                   th:href="@{/(page=${posts.number + 1}, search=${search}, category=${category})}">다음</a>
            </li>
        </ul>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>